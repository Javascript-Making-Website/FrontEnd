<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Emotion Playlist Â· Playlists</title>
  <link rel="stylesheet" href="./assets/styles.css"/>
  <style>
    /* ë‚´ ì¬ìƒëª©ë¡ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
    .my-playlists-row {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      padding: 8px 4px 4px;
      scrollbar-width: thin;
    }
    .my-playlists-row::-webkit-scrollbar {
      height: 6px;
    }

    /* ì¬ìƒëª©ë¡ ì¹´ë“œ */
    .pl-card {
      position: relative;
      min-width: 220px;
      max-width: 220px;
      background: var(--card);
      border-radius: 16px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      cursor: pointer;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .pl-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0,0,0,.55);
    }

    /* ì¬ìƒëª©ë¡ ì‚­ì œ ë²„íŠ¼ (í˜¸ë²„ ì‹œ ë…¸ì¶œ) */
    .pl-delete-btn {
      position: absolute;
      bottom: 6px;
      right: 8px;
      padding: 4px 6px;
      font-size: 13px;
      border-radius: 999px;
      border: none;
      background: rgba(255, 80, 80, 0.9);
      color: #fff;
      cursor: pointer;
      opacity: 0;                 /* ê¸°ë³¸ì€ ìˆ¨ê¹€ */
      transform: translateY(4px); /* ì‚´ì§ ë‚´ë ¤ê°€ ìˆê²Œ */
      transition: opacity .15s ease, transform .15s ease;
      z-index: 5;                 /* ì¬ìƒ hover ìœ„ì— ì˜¬ë¼ì˜¤ê²Œ */
      pointer-events: none;       /* ê¸°ë³¸ì€ í´ë¦­ ì•ˆ ë¨ (í˜¸ë²„ ë•Œ ì¼œì§) */
    }
    .pl-card:hover .pl-delete-btn {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;       /* ì¹´ë“œì— í˜¸ë²„ë˜ë©´ í´ë¦­ ê°€ëŠ¥ */
    }
    .pl-delete-btn:hover {
      background: rgba(255, 40, 40, 1);
    }


    /* ì»¤ë²„(ì¸ë„¤ì¼ë“¤ ëª¨ì¸ ì‚¬ê°í˜•) */
    .pl-cover {
  position: relative; /* ë¶€ëª¨ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ ìƒëŒ€ ìœ„ì¹˜ ì§€ì • */
  width: 100%; /* ê°€ë¡œ 100% */
  aspect-ratio: 1/1; /* ì •ì‚¬ê°í˜• ë¹„ìœ¨ ìœ ì§€ */
  border-radius: 12px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
  overflow: hidden; /* ë‚´ë¶€ ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ìˆ¨ê¹€ */
  background: linear-gradient(135deg,#111,#222); /* ê¸°ë³¸ ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ */
  display: grid; /* 2x2 ê·¸ë¦¬ë“œë¡œ êµ¬ì„± */
  grid-template-columns: repeat(2,1fr); /* 2ì—´ ê· ë“± ë¶„í•  */
  grid-template-rows: repeat(2,1fr); /* 2í–‰ ê· ë“± ë¶„í•  */
  gap: 2px; /* ê²©ì ê°„ê²© 2px */
}

.pl-cover img {
  width: 100%; /* ì´ë¯¸ì§€ ê°€ë¡œ 100% */
  height: 100%; /* ì´ë¯¸ì§€ ì„¸ë¡œ 100% */
  object-fit: cover; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì˜ì—­ ì±„ìš°ê¸° */
  display: block; /* ë¸”ë¡ ìš”ì†Œë¡œ í‘œì‹œ */
}

.pl-cover-fallback {
  grid-column: 1 / 3; /* ê°€ë¡œ 2ì¹¸ ëª¨ë‘ ì°¨ì§€ */
  grid-row: 1 / 3; /* ì„¸ë¡œ 2ì¹¸ ëª¨ë‘ ì°¨ì§€ */
  display:flex; /* ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ flex */
  align-items:center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
  justify-content:center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
  font-size:32px; /* ê¸€ì í¬ê¸° */
  opacity:.6; /* ë°˜íˆ¬ëª… */
}


    /* hover ì¬ìƒ ë²„íŠ¼ */
.pl-play-hover {
  position:absolute; /* ë¶€ëª¨ ê¸°ì¤€ ì ˆëŒ€ ìœ„ì¹˜ */
  inset:0; /* ìƒí•˜ì¢Œìš° 0ìœ¼ë¡œ ì „ì²´ ë®ê¸° */
  display:flex; /* ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ flex */
  align-items:center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
  justify-content:center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
  background:linear-gradient(135deg,rgba(0,0,0,.0),rgba(0,0,0,.45)); /* ìœ„ì—ì„œ ì•„ë˜ë¡œ ê·¸ë¼ë°ì´ì…˜ ì˜¤ë²„ë ˆì´ */
  opacity:0; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
  transition:opacity .15s ease, transform .15s ease; /* ë¶€ë“œëŸ¬ìš´ í‘œì‹œ/í™•ëŒ€ ì• ë‹ˆë©”ì´ì…˜ */
  pointer-events:none; /* ì´ˆê¸°ì—ëŠ” í´ë¦­ ì´ë²¤íŠ¸ ë¬´ì‹œ */
}

.pl-card:hover .pl-play-hover {
  opacity:1; /* ì¹´ë“œ í˜¸ë²„ ì‹œ í‘œì‹œ */
  transform:scale(1.02); /* ì‚´ì§ í™•ëŒ€ */
  pointer-events:auto; /* í´ë¦­ ê°€ëŠ¥ */
}

.pl-play-btn {
  width:56px; /* ë²„íŠ¼ ê°€ë¡œ */
  height:56px; /* ë²„íŠ¼ ì„¸ë¡œ */
  border-radius:50%; /* ì›í˜• ë²„íŠ¼ */
  border:none; /* í…Œë‘ë¦¬ ì œê±° */
  display:flex; /* ì•„ì´ì½˜ ì¤‘ì•™ ì •ë ¬ */
  align-items:center; /* ì„¸ë¡œ ì¤‘ì•™ */
  justify-content:center; /* ê°€ë¡œ ì¤‘ì•™ */
  background:var(--accent, #1ed760); /* ê¸°ë³¸ ë…¹ìƒ‰ ê°•ì¡°ìƒ‰ */
  font-size:24px; /* ì•„ì´ì½˜ í¬ê¸° */
  cursor:pointer; /* ë§ˆìš°ìŠ¤ í¬ì¸í„° ë³€ê²½ */
}

.pl-meta-title {
  font-weight:600; /* ì œëª© ë‘ê»ê²Œ */
  font-size:16px; /* ì œëª© í¬ê¸° */
}

.pl-meta-sub {
  font-size:12px; /* ë¶€ì œëª© í¬ê¸° */
  opacity:.7; /* ë°˜íˆ¬ëª… */
}


    /* ê³µìœ  ì¬ìƒëª©ë¡ ë¦¬ìŠ¤íŠ¸ */
.pl-public-row {
  display:flex; /* í–‰ ë ˆì´ì•„ì›ƒ */
  gap:10px; /* í•­ëª© ê°„ê²© */
  align-items:center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
  padding:8px 0; /* ìœ„ì•„ë˜ ì—¬ë°± */
  border-bottom:1px solid rgba(255,255,255,.04); /* ì•„ë˜ êµ¬ë¶„ì„  */
  cursor:pointer; /* ë§ˆìš°ìŠ¤ í¬ì¸í„° ë³€ê²½ */
}

.pl-public-thumb {
  width:56px; /* ì¸ë„¤ì¼ ê°€ë¡œ */
  height:56px; /* ì¸ë„¤ì¼ ì„¸ë¡œ */
  border-radius:8px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
  background:#111; /* ê¸°ë³¸ ë°°ê²½ìƒ‰ */
  overflow:hidden; /* ë‚´ìš© ë„˜ì¹¨ ìˆ¨ê¹€ */
  flex-shrink:0; /* ì¶•ì†Œ ë°©ì§€ */
  display:grid; /* 2x2 ê·¸ë¦¬ë“œ */
  grid-template-columns:repeat(2,1fr); /* ì—´ 2ì¹¸ */
  grid-template-rows:repeat(2,1fr); /* í–‰ 2ì¹¸ */
  gap:1px; /* ê·¸ë¦¬ë“œ ê°„ê²© */
}

.pl-public-thumb img {
  width:100%; 
  height:100%; 
  object-fit:cover; /* ì´ë¯¸ì§€ ì˜ì—­ ì±„ìš°ê¸° */
}

.badge-pill {
  border-radius:999px; /* ë‘¥ê·¼ ë°°ì§€ */
  padding:2px 8px; /* ì•ˆìª½ ì—¬ë°± */
  font-size:11px; /* ê¸€ì í¬ê¸° */
  background:rgba(255,255,255,.08); /* ë°˜íˆ¬ëª… ë°°ê²½ */
}
</style>
</head>
<body data-mood="calm" data-auth-required="playlist"> <!-- í˜ì´ì§€ ë°”ë””, ê°ì •/ê¶Œí•œ ì†ì„± -->

<header class="topbar">
  <div class="brand">ğŸ“‚ ì¬ìƒëª©ë¡</div> <!-- ìƒë‹¨ ë¸Œëœë“œ ë¡œê³ /í…ìŠ¤íŠ¸ -->
  <nav class="nav">
    <!-- ìƒë‹¨ ë‚´ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
    <a href="./home.html" class="btn">í™ˆ</a>
    <a href="./search.html" class="btn">ê²€ìƒ‰</a>
    <a href="./playlist.html" class="btn">ë‚´ ì¬ìƒëª©ë¡</a>
    <a href="./login.html" id="loginLink" class="btn">ë¡œê·¸ì¸</a>
    <span id="userBadge" class="badge hidden"></span> <!-- ë¡œê·¸ì¸ ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ -->
    <button id="logoutBtn" class="btn hidden">ë¡œê·¸ì•„ì›ƒ</button> <!-- ë¡œê·¸ì¸ ì‹œ í™œì„±í™” -->
  </nav>
</header>

<main style="padding:16px;display:flex;flex-direction:column;gap:24px"> <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­, ì„¸ë¡œ ë ˆì´ì•„ì›ƒ, í•­ëª© ê°„ê²© -->


  <!-- ë‚´ ì¬ìƒëª©ë¡ (ê°€ë¡œ ìŠ¤í¬ë¡¤ ì²« ì¤„) -->
  <section class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:12px">
      <div class="title">ë‚´ ì¬ìƒëª©ë¡</div>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="plTitle"
              placeholder="ì¬ìƒëª©ë¡ ì´ë¦„"
              style="padding:8px 10px;border-radius:999px;min-width:180px;
                      background:var(--card);color:var(--text);
                      border:1px solid rgba(255,255,255,.16)"/>

        <!-- ğŸ¨ ì¬ìƒëª©ë¡ ìƒ‰ ì„ íƒ -->
        <div style="display:flex;align-items:center;gap:6px;font-size:12px;">
          <span class="sub" style="opacity:.8;">í…Œë§ˆ ìƒ‰</span>
          <input id="plColor"
                type="color"
                value="#22d3ee"
                style="width:32px;height:32px;border-radius:50%;border:none;padding:0;cursor:pointer;background:transparent;"/>
        </div>
  <button id="createPL" class="btn primary">ìƒì„±</button>
</div>

    </div>

    <div id="myPlaylistsRow" class="my-playlists-row">
      <!-- JS ë Œë”ë§ -->
    </div>
  </section>

  <!-- ê³µìœ  ì¬ìƒëª©ë¡ (ì•„ë˜, ì„¸ë¡œ ìŠ¤í¬ë¡¤) -->
  <section class="panel" style="max-height:420px;overflow-y:auto;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
      <div class="title">ê³µìœ  ì¬ìƒëª©ë¡</div>
      <div style="display:flex;gap:4px">
        <button class="btn" id="sortRecent" data-sort="recent">ìµœì‹ </button>
        <button class="btn" id="sortPopular" data-sort="popular">ì¸ê¸°</button>
      </div>
    </div>

    <div id="publicLists">
      <!-- JS ë Œë”ë§ -->
    </div>
  </section>
</main>

<script src="./assets/api.js"></script>
<script src="./assets/auth.js"></script>
<script>
  // í˜ì´ì§€ ë¡œë“œë˜ìë§ˆì ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸
if (window.Auth) {
  Auth.requireLogin('playlist'); // ë¡œê·¸ì¸ í•„ìš” í˜ì´ì§€ì¼ ê²½ìš° ì¸ì¦ ì²´í¬
}

const $ = (s) => document.querySelector(s); // ê°„ë‹¨í•œ ì„ íƒì í•¨ìˆ˜

function buildCoverThumbs(items) {
  // ìµœëŒ€ 4ê°œì˜ ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì¶”ì¶œ
  const thumbs = (items || [])
    .map(t => t.thumb) // thumb ì†ì„±ë§Œ ì¶”ì¶œ
    .filter(Boolean)   // null/undefined ì œê±°
    .slice(0, 4);     // ìµœëŒ€ 4ê°œ
  return thumbs;
}

function goPlaylistDetail(id) {
  // íŠ¹ì • ì¬ìƒëª©ë¡ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
  location.href = `./playlist_view.html?id=${encodeURIComponent(id)}`;
}

async function renderMy() {
  const row = $('#myPlaylistsRow'); // ë‚´ ì¬ìƒëª©ë¡ ì»¨í…Œì´ë„ˆ ì„ íƒ
  row.innerHTML = ''; // ì´ˆê¸°í™”

  try {
    const res = await API.playlists(); // ì„œë²„ì—ì„œ ë‚´ ì¬ìƒëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    console.log('â–¶ /api/playlists ê²°ê³¼:', res); // ë””ë²„ê¹…ìš©
    const items = res.items || [];

    if (!items.length) {
      // ì¬ìƒëª©ë¡ì´ ì—†ì„ ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€
      row.innerHTML =
        '<div class="sub" style="opacity:.7;padding:4px 8px;">ì•„ì§ ë§Œë“  ì¬ìƒëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì˜¤ë¥¸ìª½ì—ì„œ ìƒˆë¡œ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</div>';
      return;
    }

      items.forEach(pl => {
        const card = document.createElement('div');
        card.className = 'pl-card'; // ì¬ìƒëª©ë¡ ì¹´ë“œ ì»¨í…Œì´ë„ˆ
        card.dataset.id = pl.id; // í˜¹ì‹œ ë‚˜ì¤‘ì— ì“¸ ìˆ˜ ìˆìœ¼ë‹ˆ ë„£ì–´ë‘ 

        // ğŸ”¥ ì´ ì¬ìƒëª©ë¡ì˜ ìƒ‰ (ì—†ìœ¼ë©´ ê¸°ë³¸)
        const theme = pl.theme_color || '#22d3ee'; // í…Œë§ˆ ìƒ‰ìƒ, ì—†ìœ¼ë©´ ê¸°ë³¸ ìƒ‰ ì‚¬ìš©
        card.style.background = `linear-gradient(135deg, ${theme}25, #020617)`; // ì¹´ë“œ ë°°ê²½ ê·¸ë¼ë°ì´ì…˜
        card.style.border = `1px solid ${theme}55`; // ì¹´ë“œ í…Œë‘ë¦¬ ìƒ‰ìƒ

        const thumbs = buildCoverThumbs(pl.items); // ìµœëŒ€ 4ê°œì˜ ì¸ë„¤ì¼ ê°€ì ¸ì˜¤ê¸°
        const cover = document.createElement('div');
        cover.className = 'pl-cover'; // ì¸ë„¤ì¼ ì»¨í…Œì´ë„ˆ

        if (thumbs.length) {
          // ì¸ë„¤ì¼ì´ ìˆì„ ê²½ìš°
          thumbs.forEach(src => {
            const img = document.createElement('img');
            img.src = src; // ì´ë¯¸ì§€ ê²½ë¡œ
            img.alt = 'thumb'; // ëŒ€ì²´ í…ìŠ¤íŠ¸
            cover.appendChild(img);
          });
          // ì¸ë„¤ì¼ì´ 4ê°œ ë¯¸ë§Œì´ë©´ ë‚¨ì€ ì¹¸ì„ ë°°ê²½ divë¡œ ì±„ì›€
          while (cover.childElementCount < 4) {
            const div = document.createElement('div');
            div.style.background = '#111';
            cover.appendChild(div);
          }
        } else {
          // ì¸ë„¤ì¼ ì—†ì„ ê²½ìš° fallback í‘œì‹œ
          const fallback = document.createElement('div');
          fallback.className = 'pl-cover-fallback';
          fallback.textContent = 'ğŸµ'; // ìŒì•… ì•„ì´ì½˜
          cover.appendChild(fallback);
        }

        const hover = document.createElement('div');
        hover.className = 'pl-play-hover'; // í˜¸ë²„ ì‹œ ì¬ìƒ ë²„íŠ¼ ì˜¤ë²„ë ˆì´
        const playBtn = document.createElement('button');
        playBtn.className = 'pl-play-btn'; // ì¬ìƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼
        playBtn.innerHTML = 'â–¶'; // ì¬ìƒ ì•„ì´ì½˜

        // ë²„íŠ¼ ë°°ê²½ë„ ì¬ìƒëª©ë¡ ìƒ‰ìœ¼ë¡œ
        playBtn.style.background = theme;
        hover.appendChild(playBtn);
        cover.appendChild(hover);

        // ğŸ”¥ ì—¬ê¸°: ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
        deleteBtn.addEventListener('click', async (e) => {
        e.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
        if (!confirm(`"${pl.title}" ì¬ìƒëª©ë¡ì„ ì‚­ì œí• ê¹Œìš”?`)) return; // ì‚­ì œ í™•ì¸

      try {
        const res = await API.deletePlaylist(pl.id); // API í˜¸ì¶œ: ì¬ìƒëª©ë¡ ì‚­ì œ
        if (res.ok) {
          card.remove(); // ì‚­ì œ ì„±ê³µ ì‹œ ì¹´ë“œ ì œê±°
          if (!row.children.length) {
            // ì¹´ë“œê°€ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
            row.innerHTML =
              '<div class="sub" style="opacity:.7;padding:4px 8px;">ì•„ì§ ë§Œë“  ì¬ìƒëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì˜¤ë¥¸ìª½ì—ì„œ ìƒˆë¡œ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</div>';
          }
        } else {
          alert('ì‚­ì œ ì‹¤íŒ¨: ' + (res.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜')); // ì‹¤íŒ¨ ì•Œë¦¼
        }
      } catch (err) {
        console.warn('â–¶ /api/playlists/:id DELETE ì‹¤íŒ¨:', err); // ì½˜ì†” ë¡œê·¸
        alert('ì¬ìƒëª©ë¡ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); // ì˜ˆì™¸ ì²˜ë¦¬
      }
    });

        row.appendChild(card); // ì¹´ë“œ rowì— ì¶”ê°€
      });
    } catch (e) {
  console.warn('â–¶ /api/playlists ì‹¤íŒ¨:', e); // ë‚´ ì¬ìƒëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨ ë¡œê·¸

  if (e && (e.status === 401 || e.error === 'login required')) {
    alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ ì£¼ì„¸ìš”.');
    location.href = './login.html?redirect=playlist'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
    return;
  }

  row.innerHTML =
    '<div class="sub" style="color:#f66;">ë‚´ ì¬ìƒëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>'; // ì˜¤ë¥˜ ë©”ì‹œì§€
}
}

async function renderPublic(sort = 'recent') {
  const wrap = $('#publicLists'); // ê³µê°œ ì¬ìƒëª©ë¡ ì»¨í…Œì´ë„ˆ
  wrap.innerHTML = ''; // ì´ˆê¸°í™”

  try {
    const res = await API.publicPlaylists({ sort, limit: 50 }); // ê³µê°œ ì¬ìƒëª©ë¡ API í˜¸ì¶œ
    console.log('â–¶ /api/playlists/public ê²°ê³¼:', res); // ë””ë²„ê¹…
    const items = res.items || [];

    if (!items.length) {
      wrap.innerHTML =
        '<div class="sub" style="opacity:.7;">ê³µê°œ ì¬ìƒëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>'; // ì•ˆë‚´ ë©”ì‹œì§€
      return;
    }

    items.forEach(pl => {
      const row = document.createElement('div');
      row.className = 'pl-public-row'; // ê³µê°œ ì¬ìƒëª©ë¡ í–‰

      const thumbBox = document.createElement('div');
      thumbBox.className = 'pl-public-thumb'; // ì¸ë„¤ì¼ ë°•ìŠ¤

      const thumbs = buildCoverThumbs(pl.items); // ì¸ë„¤ì¼ ìµœëŒ€ 4ê°œ
      if (thumbs.length) {
        thumbs.forEach(src => {
          const img = document.createElement('img');
          img.src = src;
          img.alt = 'thumb';
          thumbBox.appendChild(img);
        });
        while (thumbBox.childElementCount < 4) {
          const d = document.createElement('div');
          d.style.background = '#111'; // ë¹ˆ ì¹¸ ì±„ìš°ê¸°
          thumbBox.appendChild(d);
        }
      } else {
        // ì¸ë„¤ì¼ ì—†ì„ ê²½ìš° fallback
        const d = document.createElement('div');
        d.style.gridColumn = '1/3';
        d.style.gridRow = '1/3';
        d.style.display = 'flex';
        d.style.alignItems = 'center';
        d.style.justifyContent = 'center';
        d.textContent = 'ğŸµ';
        thumbBox.appendChild(d);
      }

      const meta = document.createElement('div'); // ë©”íƒ€ ì •ë³´
      meta.style.flex = '1';
      meta.innerHTML = `
        <div class="title" style="font-size:15px;">${pl.title}</div>
        <div class="sub" style="font-size:12px;">
          ${pl.owner_name || 'ìµëª…'} Â· íŠ¸ë™ ${(pl.items || []).length}ê°œ
        </div>
      `;

      const right = document.createElement('div'); // ì¢‹ì•„ìš” ë° ê³µê°œ ì—¬ë¶€
      right.style.display = 'flex';
      right.style.flexDirection = 'column';
      right.style.alignItems = 'flex-end';
      right.innerHTML = `
        <span class="badge-pill">â™¥ ${pl.likes || 0}</span>
        <span class="sub" style="font-size:11px;margin-top:4px;">${pl.is_public ? 'ê³µê°œ' : 'ë¹„ê³µê°œ'}</span>
      `;

      row.appendChild(thumbBox);
      row.appendChild(meta);
      row.appendChild(right);

      row.addEventListener('click', () => {
        goPlaylistDetail(pl.id); // í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ ì´ë™
      });

      wrap.appendChild(row); // ê³µê°œ ì¬ìƒëª©ë¡ ì¶”ê°€
    });
  } catch (e) {
    console.warn('â–¶ /api/playlists/public ì‹¤íŒ¨:', e); // ì˜¤ë¥˜ ë¡œê·¸
    wrap.innerHTML =
      '<div class="sub" style="color:#f66;">ê³µê°œ ì¬ìƒëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>'; // ì˜¤ë¥˜ ë©”ì‹œì§€
  }
}

// ì¬ìƒëª©ë¡ ìƒì„±
$('#createPL').addEventListener('click', async () => {
  const input = $('#plTitle'); // ì œëª© ì…ë ¥
  const colorInput = $('#plColor'); // ìƒ‰ìƒ ì…ë ¥
  const title = input.value.trim();
  if (!title) {
    alert('ì¬ìƒëª©ë¡ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
    input.focus();
    return;
  }

  const themeColor = (colorInput && colorInput.value) ? colorInput.value : '#22d3ee'; // ê¸°ë³¸ í…Œë§ˆ ìƒ‰

  try {
    const res = await API.createPlaylist({ title, isPublic: false, themeColor }); // API í˜¸ì¶œ: ì¬ìƒëª©ë¡ ìƒì„±
    console.log('â–¶ /api/playlists POST ê²°ê³¼:', res);
    input.value = ''; // ì…ë ¥ ì´ˆê¸°í™”
    await renderMy(); // ë‚´ ì¬ìƒëª©ë¡ ë‹¤ì‹œ ë Œë”
  } catch (e) {
    console.warn('â–¶ /api/playlists POST ì‹¤íŒ¨:', e);
    if (e && (e.status === 401 || e.error === 'login required')) {
      alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ ì£¼ì„¸ìš”.');
      location.href = './login.html?redirect=playlist';
    } else {
      alert('ì¬ìƒëª©ë¡ ìƒì„± ì‹¤íŒ¨: ' + (e?.error ?? 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
    }
  }
});

// ê³µê°œ ì¬ìƒëª©ë¡ ì •ë ¬ ë²„íŠ¼ ì´ë²¤íŠ¸
$('#sortRecent').addEventListener('click', () => renderPublic('recent'));
$('#sortPopular').addEventListener('click', () => renderPublic('popular'));

// ì´ˆê¸° ë Œë”ë§
renderMy(); // ë‚´ ì¬ìƒëª©ë¡
renderPublic('recent'); // ê³µê°œ ì¬ìƒëª©ë¡ ìµœì‹ ìˆœ
</script>
</body>
</html>
