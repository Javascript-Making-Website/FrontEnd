<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emotion Playlist Â· Search</title>
  <link rel="stylesheet" href="./assets/styles.css" />
</head>
<body data-mood="calm">
  <header class="topbar">
    <div class="brand">ğŸ” Search</div>
    <nav class="nav">
      <a href="./home.html" class="btn">í™ˆ</a>
      <a href="./playlist.html" class="btn">ë‚´ ì¬ìƒëª©ë¡</a>
      <a href="./login.html" class="btn" id="loginLink">ë¡œê·¸ì¸</a>
      <span id="userBadge" class="badge hidden"></span>
      <button id="logoutBtn" class="btn hidden">ë¡œê·¸ì•„ì›ƒ</button>
    </nav>
  </header>

  <main class="panel" style="max-width:980px;margin:12px auto;">
    <form id="searchForm" class="search">
      <input id="searchInput" placeholder="ë…¸ë˜/ì•„í‹°ìŠ¤íŠ¸ ê²€ìƒ‰ (ë°ëª¨: ë”ë¯¸ ë°ì´í„°)" />
      <button class="btn" type="submit">ê²€ìƒ‰</button>
    </form>

    <div class="moods" id="moodChips"></div>
    <div id="resultList" class="list" style="margin-top:10px;"></div>
  </main>

  <footer class="foot">ê²°ê³¼ í´ë¦­ ì‹œ ê³¡ì„ ì„ íƒí•˜ê³  í™ˆìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</footer>

  <!-- ì „ì—­ API ë¨¼ì € -->
  <script src="./assets/api.js"></script>
  <!-- í—¤ë” ë¡œê·¸ì¸ ìƒíƒœ ë™ê¸°í™” (API ë’¤ì— ë¡œë“œ) -->
  <script src="./assets/auth.js"></script>

  <script>
  const BASE = 'http://localhost:3001';

    // í˜„ì¬ ì£¼ì†Œì°½(location)ì˜ ë¬¼ìŒí‘œ(?) ë’¤ì— ì íŒ ë‚´ìš©ë“¤(.search)ì„ ë¶„ì„í•  íƒì •(sp)ì„ ë¶€ë¦…ë‹ˆë‹¤.
    // -> ì˜ˆ: "?mood=happy&genre=kpop" ë¶€ë¶„ì„ ì½ê¸° ì¢‹ê²Œ ë¶„í•´í•´ì¤ë‹ˆë‹¤.
    const sp = new URLSearchParams(location.search);

    // íƒì •ì—ê²Œ "í˜¹ì‹œ 'mood(ê¸°ë¶„)'ë¼ê³  ì íŒ ê²Œ ìˆë‹ˆ?"ë¼ê³  ë¬¼ì–´ë´…ë‹ˆë‹¤.
    // -> || '': ìˆìœ¼ë©´ ê·¸ê±¸ ê°€ì ¸ì˜¤ê³ (initialMood), ì—†ìœ¼ë©´ ë¹ˆì¹¸('')ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤. (ì—ëŸ¬ ë°©ì§€ìš© ë³´í—˜)
    const initialMood   = sp.get('mood')   || '';

    // "í˜¹ì‹œ 'genre(ì¥ë¥´)'ë¼ê³  ì íŒ ê²Œ ìˆë‹ˆ?"
    const initialGenre  = sp.get('genre')  || '';

    // "í˜¹ì‹œ 'nation(ë‚˜ë¼)'ì´ë¼ê³  ì íŒ ê²Œ ìˆë‹ˆ?"
    const initialNation = sp.get('nation') || '';

    // â˜… ì´ ë¶€ë¶„ì€ ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ë„˜ì–´ì™”ì„ ë•Œ ì”ë‹ˆë‹¤.
    // -> "ë…¸ë˜ë¥¼ ê²€ìƒ‰í•´ì„œ 'ì´ ì¬ìƒëª©ë¡(addToPlaylist)'ì— ì¶”ê°€í•´ì¤˜!"ë¼ê³  IDë¥¼ ë°›ì•„ì˜¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
    // -> ì—†ìœ¼ë©´ null(ì—†ìŒ)ë¡œ ë‘¡ë‹ˆë‹¤.
    const targetPlaylistIdFromUrl = sp.get('addToPlaylist') || null; 

    // ìœ„ì—ì„œ ì°¾ì•„ë‚¸ 'ì´ˆê¸° ê¸°ë¶„'ì„ 'í˜„ì¬ ê¸°ë¶„(currentMood)'ìœ¼ë¡œ í™•ì •í•©ë‹ˆë‹¤.
    let currentMood = initialMood;

    //  ë§Œì•½ ì´ˆê¸° ê¸°ë¶„(initialMood)ì´ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´?
    if (initialMood) {
      // -> ì›¹ì‚¬ì´íŠ¸ ë°°ê²½ìƒ‰ì´ë‚˜ ë¶„ìœ„ê¸°ë¥¼ ê·¸ ê¸°ë¶„ì— ë§ì¶°ì„œ ì¦‰ì‹œ ë°”ê¿‰ë‹ˆë‹¤.
      // -> body íƒœê·¸ì— data-mood="happy" ê°™ì€ ê¼¬ë¦¬í‘œë¥¼ ë¶™ì—¬ì£¼ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.
      document.body.setAttribute('data-mood', initialMood);
    }

  // í˜ì´ì§€ë„¤ì´ì…˜ + ìµœê·¼ ê²€ìƒ‰ ê²°ê³¼ ì €ì¥ìš©
  let currentQuery   = '';
  let nextPageToken  = null;
  let lastSearchList = [];   // â˜… playerë¡œ ë„˜ê¸¸ ë¦¬ìŠ¤íŠ¸
  let isLoading      = false; // â˜… ì¤‘ë³µ ë¡œë”© ë°©ì§€

  // ì¬ìƒëª©ë¡ ì¶”ê°€ìš© ìƒíƒœ
  let trackToAdd = null;

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // player.htmlë¡œ ì´ë™í•˜ëŠ” ê³µí†µ í•¨ìˆ˜
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 // â˜…â˜…â˜… ë…¸ë˜ë¥¼ í´ë¦­í•˜ë©´ í”Œë ˆì´ì–´ í˜ì´ì§€ë¡œ ì´ë™ì‹œí‚¤ëŠ” í•¨ìˆ˜ (track: í´ë¦­í•œ ë…¸ë˜ ì •ë³´)
function goPlay(track) {

  // 1. [ì§ ì‹¸ê¸°] í˜„ì¬ ê²€ìƒ‰í–ˆë˜ ëª©ë¡ê³¼ ì„¤ì •ì„ 'ë¸Œë¼ìš°ì € ë©”ëª¨ì¥(localStorage)'ì— ì €ì¥í•´ë‘¡ë‹ˆë‹¤.
  try {
    // (1) "ë°©ê¸ˆê¹Œì§€ ë³´ê³  ìˆë˜ ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸(lastSearchList)ë¥¼ ì €ì¥í•´!"
    // -> JSON.stringify: ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë¬¸ìì—´(ê¸€ì)ë¡œ í¬ì¥í•´ì„œ ì €ì¥í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
    localStorage.setItem('lastSearchList', JSON.stringify(lastSearchList));

    // (2) "ë°©ê¸ˆê¹Œì§€ ì„¤ì •í–ˆë˜ ê¸°ë¶„, ì¥ë¥´, ê²€ìƒ‰ì–´ ë“±(Context)ë„ ìŠì§€ ë§ê³  ì €ì¥í•´!"
    // -> í”Œë ˆì´ì–´ í™”ë©´ì— ê°€ì„œë„ "ì•„, ì´ ì‚¬ëŒì´ ì›ë˜ 'ì‹ ë‚˜ëŠ”' ê±° ì°¾ê³  ìˆì—ˆì§€?"ë¼ê³  ì•Œ ìˆ˜ ìˆê²Œ í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
    localStorage.setItem('lastSearchContext', JSON.stringify({
      mood: initialMood,
      genre: initialGenre,
      nation: initialNation,
      q: currentQuery, // ê²€ìƒ‰ì–´
    }));
  } catch (e) {
    // (3) [ì—ëŸ¬ ì²˜ë¦¬] ì €ì¥ ê³µê°„ì´ ê½‰ ì°¼ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë‚˜ë©´?
    // -> ì¿¨í•˜ê²Œ ê²½ê³ ë§Œ ë‚¨ê¸°ê³  ë„˜ì–´ê°‘ë‹ˆë‹¤. (ì´ë™ì€ í•´ì•¼ í•˜ë‹ˆê¹Œìš”)
    console.warn('failed to save lastSearchList', e);
  }


  // 2. [ì£¼ì†Œí‘œ ë§Œë“¤ê¸°] í”Œë ˆì´ì–´ í˜ì´ì§€ë¡œ ê°€ì ¸ê°ˆ 'ì£¼ì†Œ ê¼¬ë¦¬í‘œ(Query String)'ë¥¼ ë§Œë“­ë‹ˆë‹¤.
  const params = new URLSearchParams();

  // (1) "ê¸°ë¶„(mood) ì„¤ì •ì´ ìˆìœ¼ë©´ ê¼¬ë¦¬í‘œì— ì ì–´."
  if (initialMood)   params.set('mood',   initialMood);
  
  // (2) "ì¥ë¥´(genre) ì„¤ì •ì´ ìˆìœ¼ë©´ ì ì–´."
  if (initialGenre)  params.set('genre',  initialGenre);
  
  // (3) "êµ­ê°€(nation) ì„¤ì •ì´ ìˆìœ¼ë©´ ì ì–´."
  if (initialNation) params.set('nation', initialNation);
  
  // (4) [ì¶œì²˜ í‘œì‹œ] "ì´ ì†ë‹˜ì€ 'ê²€ìƒ‰(search)' í™”ë©´ì—ì„œ ì™”ìŠµë‹ˆë‹¤"ë¼ê³  í‘œì‹œ.
  params.set('from', 'search');
  
  // (5) [í•µì‹¬] "ê·¸ë¦¬ê³  ê°€ì¥ ì¤‘ìš”í•œ, 'ì¬ìƒí•  ë…¸ë˜ ID'ëŠ” ì´ê±°ì•¼!"
  params.set('id', track.id);


  // ìœ„ì—ì„œ ë§Œë“  ê¼¬ë¦¬í‘œë¥¼ ë¶™ì—¬ì„œ í”Œë ˆì´ì–´ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
  // -> ê²°ê³¼ ì˜ˆì‹œ: ./player.html?mood=happy&from=search&id=12345
  window.location.href = `./player.html?${params.toString()}`;
}


  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ì¬ìƒëª©ë¡ ì„ íƒ ëª¨ë‹¬ ê´€ë ¨
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const plModal       = document.getElementById('plPicker');
  const plModalList   = document.getElementById('plPickerList');
  const plModalHint   = document.getElementById('plPickerHint');
  const plModalClose  = document.getElementById('plPickerClose');

  function closePlaylistPicker() {
    trackToAdd = null;
    plModal.classList.add('hidden');
  }

  plModalClose.addEventListener('click', closePlaylistPicker);
  // ë°”ê¹¥ ì˜ì—­ í´ë¦­ ì‹œ ë‹«ê¸°
  plModal.addEventListener('click', (e) => {
    if (e.target === plModal) closePlaylistPicker();
  });

  async function openPlaylistPicker(track) {
    trackToAdd = track;
    plModal.classList.remove('hidden');
    plModalList.innerHTML = '<div class="sub">ì¬ìƒëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

    if (targetPlaylistIdFromUrl) {
      plModalHint.textContent = `í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì¬ìƒëª©ë¡ ID: ${targetPlaylistIdFromUrl}`;
    } else {
      plModalHint.textContent = 'ì¶”ê°€í•  ì¬ìƒëª©ë¡ì„ ì„ íƒí•˜ì„¸ìš”.';
    }

    try {
      const res = await fetch(`${BASE}/api/playlists`, {
        credentials: 'include',
      });
      if (res.status === 401) {
        alert('ë¡œê·¸ì¸ í›„ ì¬ìƒëª©ë¡ì— ê³¡ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        location.href = './login.html';
        return;
      }
      const data = await res.json();
      let lists = data.items || [];

      if (!lists.length) {
        plModalList.innerHTML = '<div class="sub">ì•„ì§ ë§Œë“  ì¬ìƒëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      // URLì—ì„œ ë„˜ì–´ì˜¨ ì¬ìƒëª©ë¡ì´ ìˆìœ¼ë©´ ë§¨ ìœ„ë¡œ ì˜¬ë¦¬ê¸°
      // 1. [VIP í™•ì¸] "í˜¹ì‹œ ì½• ì§‘ì–´ì„œ ì§€ì •ëœ ì¬ìƒëª©ë¡(targetPlaylistIdFromUrl)ì´ ìˆë‚˜ìš”?"
      // -> ì˜ˆ: í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ í™”ë©´ì—ì„œ 'ê³¡ ì¶”ê°€'ë¥¼ ëˆŒëŸ¬ì„œ ë„˜ì–´ì˜¨ ê²½ìš°
      if (targetPlaylistIdFromUrl) {
        
        const idStr = String(targetPlaylistIdFromUrl); // ì•ˆì „í•˜ê²Œ ë¬¸ìë¡œ ë³€í™˜

        // 2. [ì¤„ ì„¸ìš°ê¸°] ëª©ë¡ì„ ë³µì‚¬(slice)í•´ì„œ ì¬ì •ë ¬(sort)í•©ë‹ˆë‹¤.
        lists = lists.slice().sort((a, b) => {
          // -> Aê°€ ê·¸ 'ì§€ì •ëœ ëª©ë¡'ì´ë©´ ì•ìœ¼ë¡œ(-1), ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ(0)
          const aKey = String(a.id) === idStr ? -1 : 0;
          const bKey = String(b.id) === idStr ? -1 : 0;
          
          // -> ê²°ê³¼ì ìœ¼ë¡œ ì§€ì •ëœ ëª©ë¡ì´ ë¦¬ìŠ¤íŠ¸ ìµœìƒë‹¨(0ë²ˆ)ìœ¼ë¡œ ì˜¬ë¼ì˜¤ê²Œ ë©ë‹ˆë‹¤.
          return aKey - bKey;
        });
      }

// 3. [ì²­ì†Œ] íŒì—…ì°½ ì•ˆì„ ê¹¨ë—ì´ ë¹„ì›ë‹ˆë‹¤.
      plModalList.innerHTML = '';

      // 4. [ë°˜ë³µ] ì¬ìƒëª©ë¡(pl) í•˜ë‚˜ë§ˆë‹¤ ë²„íŠ¼ì„ ë§Œë“­ë‹ˆë‹¤.
      lists.forEach(pl => {
        const btn = document.createElement('button'); // ë²„íŠ¼ ìƒì„±
        btn.type = 'button';
        btn.className = 'btn'; // ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì ìš©

        // 5. [ê°•ì¡° ì—¬ë¶€ í™•ì¸] "ì´ê²Œ ì•„ê¹Œ ê·¸ VIP(ì§€ì •ëœ) ëª©ë¡ì¸ê°€ìš”?"
        const isTarget =
          targetPlaylistIdFromUrl &&
          String(pl.id) === String(targetPlaylistIdFromUrl);

        // 6. [ë‚´ìš© ì±„ìš°ê¸°] ì œëª©, ê³¡ ìˆ˜, ê³µê°œ/ë¹„ê³µê°œ ì—¬ë¶€ë¥¼ ì ìŠµë‹ˆë‹¤.
        btn.innerHTML = `
          <span style="flex:1;">${pl.title} Â· íŠ¸ë™ ${(pl.items || []).length}ê°œ</span>
          <span style="font-size:11px;opacity:.7;">${pl.is_public ? 'ê³µê°œ' : 'ë¹„ê³µê°œ'}</span>
        `;
        
        // 7. [ë””ìì¸] ë²„íŠ¼ ë‚´ë¶€ ì •ë ¬ (ê°€ë¡œ ë°°ì¹˜, ê°„ê²© ë“±)
        btn.style.display = 'flex';
        btn.style.alignItems = 'center';
        btn.style.gap = '6px';

        // 8. [í•˜ì´ë¼ì´íŠ¸] VIP ëª©ë¡ì´ë¼ë©´ ì´ˆë¡ìƒ‰ í…Œë‘ë¦¬ë¥¼ ì³ì„œ ëˆˆì— ë„ê²Œ í•´ì¤ë‹ˆë‹¤.
        if (isTarget) {
          btn.style.border = '1px solid var(--accent, #1ed760)';
        }

       // 9. [í´ë¦­ ì„¤ì •] ì‚¬ìš©ìê°€ ì´ ì¬ìƒëª©ë¡ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‹¤í–‰!
        btn.addEventListener('click', async () => {
          try {
            // (1) [ì„œë²„ ì „ì†¡] "ì´ ë…¸ë˜(trackId)ë¥¼, ì´ ì¬ìƒëª©ë¡(playlistId)ì˜ ë§¨ ì•(position: 0)ì— ë„£ì–´ì£¼ì„¸ìš”!"
            const resAdd = await fetch(`${BASE}/api/playlist/items`, {
              method: 'POST', // ë°ì´í„° ì €ì¥ ìš”ì²­
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include', // ë¡œê·¸ì¸ ì •ë³´ í¬í•¨
              body: JSON.stringify({
                playlistId: pl.id,
                trackId: trackToAdd.id, // ì¶”ê°€í•  ë…¸ë˜ ID
                position: 0,            // 0: ë§¨ ìœ„ì— ì¶”ê°€í•˜ê² ë‹¤ëŠ” ëœ»
              }),
            });

            // (2) [ì‘ë‹µ í™•ì¸] ì„œë²„ê°€ ë³´ë‚¸ ê²°ê³¼ë¥¼ ì—´ì–´ë´…ë‹ˆë‹¤.
            const dataAdd = await resAdd.json().catch(() => ({}));

            // (3) [ë¡œê·¸ì¸ ì²´í¬] "ì–´? ë„ˆ ë¡œê·¸ì¸ ì•ˆ í–ˆë„¤?" (401 ì—ëŸ¬)
            if (resAdd.status === 401) {
              alert('ë¡œê·¸ì¸ í›„ ì¬ìƒëª©ë¡ì— ê³¡ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
              location.href = './login.html'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì«“ì•„ëƒ„
              return;
            }

            // (4) [ì‹¤íŒ¨ ì²˜ë¦¬] ë‹¤ë¥¸ ì´ìœ ë¡œ ì‹¤íŒ¨í–ˆë‹¤ë©´? (ì˜ˆ: ê¶Œí•œ ì—†ìŒ, ì„œë²„ ì˜¤ë¥˜)
            if (!resAdd.ok) {
              alert('ì¶”ê°€ ì‹¤íŒ¨: ' + (dataAdd.error || `${resAdd.status}`));
              return;
            }

            // (5) [ì„±ê³µ!] "ì˜ ì €ì¥ëìŠµë‹ˆë‹¤"ë¼ê³  ì•Œë ¤ì£¼ê³  íŒì—…ì°½ì„ ë‹«ìŠµë‹ˆë‹¤.
            alert(`"${pl.title}" ì¬ìƒëª©ë¡ì— ê³¡ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.`);
            closePlaylistPicker();

          } catch (e) {
            // (6) [í†µì‹  ì—ëŸ¬] ì¸í„°ë„· ëŠê¹€ ë“±ìœ¼ë¡œ ì•„ì˜ˆ ì „ì†¡ì¡°ì°¨ ëª» í–ˆì„ ë•Œ
            console.error(e);
            alert('ì¬ìƒëª©ë¡ì— ì¶”ê°€í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        });

        // 10. [ë¶€ì°©] ì™„ì„±ëœ ë²„íŠ¼ì„ ëª©ë¡ ìƒìì— ì§‘ì–´ë„£ìŠµë‹ˆë‹¤.
        plModalList.appendChild(btn);
      }); // ë°˜ë³µ ë

    } catch (e) {
      // 11. [ì „ì²´ ì—ëŸ¬] ëª©ë¡ ìì²´ë¥¼ ëª» ë¶ˆëŸ¬ì™”ì„ ë•Œ (ë¹¨ê°„ ê¸€ì”¨ë¡œ ì—ëŸ¬ í‘œì‹œ)
      console.error(e);
      plModalList.innerHTML =
        '<div class="sub" style="color:#f66;">ì¬ìƒëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ì•„ì´í…œ ë Œë”ë§
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function itemEl(track) {
    // ë…¸ë˜ ì •ë³´ë¥¼ ë‹´ì„ 'íˆ¬ëª…í•œ ìƒì(div)'ë¥¼ í•˜ë‚˜ ì¡°ë¦½í•©ë‹ˆë‹¤.
    const el = document.createElement('div');
    // ìƒìì— 'item'ì´ë¼ëŠ” ìŠ¤íƒ€ì¼(CSS) ì´ë¦„í‘œë¥¼ ë¶™ì…ë‹ˆë‹¤.
    // -> CSS íŒŒì¼ì— ë¯¸ë¦¬ ì •ì˜ëœ ëŒ€ë¡œ ì˜ˆìœ ëª¨ì–‘(ì—¬ë°±, í…Œë‘ë¦¬ ë“±)ì„ ê°–ê²Œ ë©ë‹ˆë‹¤.
    el.className = 'item';
    // ì•¨ë²” í‘œì§€(thumb) ì£¼ì†Œê°€ ìˆìœ¼ë©´ ì“°ê³ , ì—†ìœ¼ë©´ ë¹ˆì¹¸('')ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤.
    const thumb = track.thumb || '';

  //  4. [ë‚´ìš© ì±„ìš°ê¸°] ìƒì(el) ì•ˆì„ ì´ë¯¸ì§€, ê¸€ì”¨, ë²„íŠ¼ìœ¼ë¡œ ì±„ì›Œ ë„£ìŠµë‹ˆë‹¤.
  // -> ë°±í‹±(`)ì„ ì‚¬ìš©í•´ì„œ HTML ì½”ë“œë¥¼ í•œ ë²ˆì— ì‘ì„±í•©ë‹ˆë‹¤.
    el.innerHTML = `
      <img src="${thumb}" alt="thumb" />
      <div style="min-width:0;">
        <div class="t">${API.cleanTitle(track.title)}</div>
        <div class="s">
          ${track.artist ?? ''} Â·
          <span class="badge">${track.source ?? ''}</span>
        </div>
      `;
      el.onclick = () => {
        localStorage.setItem('currentTrackId', track.id);
        window.location.href = './home.html';
      };
      return el;
    }

    function render(list){
      const holder = document.getElementById('resultList');
      holder.innerHTML = '';
    }
    list.forEach(t => holder.appendChild(itemEl(t)));

  function setLoadMoreVisible(visible) {
    const btn = document.getElementById('loadMoreBtn');
    if (!btn) return;
    if (visible) btn.classList.remove('hidden');
    else btn.classList.add('hidden');
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ê°ì • ì¹© ë Œë”ë§ (UIë§Œ, ê²€ìƒ‰ì€ ê·¸ëŒ€ë¡œ)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // í˜ì´ì§€ê°€ ë¡œë“œë˜ìë§ˆì ì´ í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ ë²„íŠ¼ì„ ë§Œë“­ë‹ˆë‹¤.
  (function renderMoodChips() {
    
    // ê°ì • ë²„íŠ¼ë“¤ì„ ë‹´ì„ 'ë²„íŠ¼ ì˜ì—­'ì„ ì°¾ì•„ì˜µë‹ˆë‹¤.
    const holder = document.getElementById('moodChips');

    // ë²„íŠ¼ ì˜ì—­ì„ ê¹¨ë—ì´ ë¹„ì›ë‹ˆë‹¤. (ê¸°ì¡´ ë‚´ìš©ë¬¼ ì œê±°)
    holder.innerHTML = '';

    // ë¯¸ë¦¬ ì •í•´ë‘” ê°ì • ëª©ë¡(API.MOODS)ì„ í•˜ë‚˜ì”© êº¼ë‚´ì„œ ë²„íŠ¼ì„ ë§Œë“­ë‹ˆë‹¤. 
    // mì€ ê°ì • ë°ì´í„° í•˜ë‚˜ë¥¼ ëœ»í•©ë‹ˆë‹¤.
    API.MOODS.forEach(m => {

      // ë¹„ì–´ìˆëŠ” <button> íƒœê·¸ë¥¼ í•˜ë‚˜ ë§Œë“­ë‹ˆë‹¤.
      const b = document.createElement('button');

      // ì´ ë²„íŠ¼ì˜ íƒ€ì…ì„ 'ì¼ë°˜ ë²„íŠ¼'ìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤. 
      // -> (í¼ ì•ˆì— ìˆì–´ë„ ì—”í„°í‚¤ ë“±ìœ¼ë¡œ ìë™ ì „ì†¡ë˜ì§€ ì•Šê²Œ í•˜ëŠ” ì•ˆì „ì¥ì¹˜)
      b.type = 'button';

      // css
      b.className = 'chip';

      // ë²„íŠ¼ ìœ„ì— ë¯¸ë¦¬ ì„¤ì •í•´ë‘” ê°ì •ì„ ì ìŠµë‹ˆë‹¤.
      b.textContent = m.label;

      // ì‚¬ìš©ìê°€ ì´ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ
      b.onclick = async () => {
        
        // ì›¹ì‚¬ì´íŠ¸ ì „ì²´ ë°°ê²½ìƒ‰ ë“±ì„ ì„ íƒí•œ ê°ì •ì— ë§ì¶° ë°”ê¿‰ë‹ˆë‹¤.
        // -> body íƒœê·¸ì— data-mood="happy" ê°™ì€ ê¼¬ë¦¬í‘œë¥¼ ë¶™ì—¬ì£¼ë©´ CSSê°€ ìƒ‰ì„ ë°”ê¿‰ë‹ˆë‹¤.
        document.body.setAttribute('data-mood', m.key);

        // í”„ë¡œê·¸ë¨ ë‚´ë¶€ ë³€ìˆ˜(currentMood)ì— "ì§€ê¸ˆ ì„ íƒëœ ê°ì •ì€ ì´ê±°ì•¼"ë¼ê³  ì €ì¥í•©ë‹ˆë‹¤.
        // -> ë‚˜ì¤‘ì— ê²€ìƒ‰í•  ë•Œ ì´ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        currentMood = m.key;

        // ìƒˆë¡œìš´ ê°ì •ìœ¼ë¡œ ê²€ìƒ‰í•˜ë‹ˆê¹Œ, í˜ì´ì§€ ë²ˆí˜¸ë¥¼ '1í˜ì´ì§€'ë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.
        // -> ì´ì „ì— 5í˜ì´ì§€ë¥¼ ë³´ê³  ìˆì—ˆë”ë¼ë„, ê°ì •ì´ ë°”ë€Œë©´ ì²˜ìŒë¶€í„° ë´ì•¼ í•˜ë‹ˆê¹Œìš”.
        nextPageToken = null; 

        // ì„¤ì •ëœ ê°ì •(currentMood)ì„ ê°€ì§€ê³  ì„œë²„ì—ì„œ ìƒˆ ë…¸ë˜ ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        // -> append: false (ì¤‘ìš”!): "ê¸°ì¡´ ë…¸ë˜ ëª©ë¡ì€ ì‹¹ ì§€ìš°ê³  ìƒˆë¡œ ê·¸ë ¤ë¼!"
        await fetchAndRender({ append: false });
      };

      // (6) ì™„ì„±ëœ ë²„íŠ¼(b)ì„ 'ë²„íŠ¼ ì˜ì—­(holder)'ì— ì§‘ì–´ë„£ìŠµë‹ˆë‹¤.
      holder.appendChild(b);
    });
  })();

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ì‹¤ì œ /api/search í˜¸ì¶œ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// -> append: trueë©´ 'ë” ë³´ê¸°' (ë°‘ì— ì´ì–´ ë¶™ì´ê¸°), falseë©´ 'ìƒˆ ê²€ìƒ‰' (ë®ì–´ì“°ê¸°)
async function fetchAndRender({ append = false } = {}) {

  // 1. [ì¤‘ë³µ ë°©ì§€] "ì§€ê¸ˆ ì´ë¯¸ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘ì¸ê°€ìš”?"
  // -> ë¡œë”© ì¤‘(isLoading)ì´ë©´ ë˜ ìš”ì²­í•˜ì§€ ë§ê³  ê·¸ëƒ¥ ëŒì•„ê°€ì„¸ìš”. (ê´‘í´ ë°©ì§€)
  if (isLoading) return;         
  
  // 2. [ê¹ƒë°œ ê½‚ê¸°] "ì, ì§€ê¸ˆë¶€í„° ë¡œë”© ì‹œì‘í•©ë‹ˆë‹¤!" (ë‹¤ë¥¸ ìš”ì²­ ëª» ë“¤ì–´ì˜¤ê²Œ ì ê¸ˆ)
  isLoading = true;

  // 3. [ë²„íŠ¼ ìˆ¨ê¹€] ë¡œë”©í•˜ëŠ” ë™ì•ˆ ì‚¬ìš©ìê°€ 'ë” ë³´ê¸°' ë²„íŠ¼ì„ ë˜ ëˆ„ë¥´ì§€ ëª»í•˜ê²Œ ì ì‹œ ìˆ¨ê¹ë‹ˆë‹¤.
  // -> (ìƒˆë¡œ ê²€ìƒ‰í•  ë• ì–´ì°¨í”¼ í™”ë©´ì´ ë°”ë€Œë‹ˆ ìƒê´€ì—†ê³ , 'ë” ë³´ê¸°'ì¼ ë•Œë§Œ ì¤‘ìš”)
  if (append) setLoadMoreVisible(false); 

  // 4. [ì£¼ë¬¸ì„œ ì‘ì„±] ì„œë²„ì— ë³´ë‚¼ ê²€ìƒ‰ ì¡°ê±´ë“¤ì„ ì ìŠµë‹ˆë‹¤.
  const params = {
    q: currentQuery,       // ê²€ìƒ‰ì–´ (ì˜ˆ: ì•„ì´ìœ )
    mood: currentMood,     // ê¸°ë¶„ (ì˜ˆ: ì‹ ë‚˜ëŠ”)
    genre: initialGenre,   // ì¥ë¥´
    nation: initialNation, // êµ­ê°€
  };

  // 5. [í˜ì´ì§€ ë²ˆí˜¸] "ì´ì–´ì„œ ë³´ëŠ” ê±°ë¼ë©´(append), ë‹¤ìŒ í˜ì´ì§€ ë²ˆí˜¸í‘œë„ ì±™ê¸°ì„¸ìš”."
  if (append && nextPageToken) {
    params.pageToken = nextPageToken;
  }

  try {
    // 6. [ì„œë²„ ìš”ì²­] ì‘ì„±í•œ ì£¼ë¬¸ì„œ(params)ë¥¼ ë“¤ê³  ì„œë²„ì— ë‹¤ë…€ì˜µë‹ˆë‹¤.
    // -> await: ë°ì´í„° ë°›ì•„ì˜¬ ë•Œê¹Œì§€ ì—¬ê¸°ì„œ ë©ˆì¶°ì„œ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
    const r = await API.search(params);
    
    // -> ë°›ì•„ì˜¨ ë°ì´í„°ì—ì„œ ë…¸ë˜ ëª©ë¡ë§Œ êº¼ëƒ…ë‹ˆë‹¤. (ì—†ìœ¼ë©´ ë¹ˆ ëª©ë¡ [])
    const items = r.items || [];

    // 7. [ê¸°ì–µí•˜ê¸°] â˜… ì¤‘ìš”!
    // -> ë‚˜ì¤‘ì— í”Œë ˆì´ì–´ í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°ˆ ë•Œë¥¼ ëŒ€ë¹„í•´ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë³€ìˆ˜(lastSearchList)ì— ì €ì¥í•´ë‘¡ë‹ˆë‹¤.
    if (append) {
      // ì´ì–´ ë¶™ì´ê¸° ëª¨ë“œë©´: ê¸°ì¡´ ëª©ë¡ ë’¤ì— ìƒˆ ëª©ë¡ì„ í’€ì¹ í•´ì„œ ë¶™ì…ë‹ˆë‹¤(concat).
      lastSearchList = lastSearchList.concat(items);
    } else {
      // ìƒˆ ê²€ìƒ‰ ëª¨ë“œë©´: ê¸°ì¡´ ëª©ë¡ ì‹¹ ë²„ë¦¬ê³  ìƒˆ ëª©ë¡ìœ¼ë¡œ ê°ˆì•„ì¹˜ì›ë‹ˆë‹¤.
      lastSearchList = items.slice();
    }

    // 8. [í™”ë©´ ê·¸ë¦¬ê¸°] ê°€ì ¸ì˜¨ ë…¸ë˜ë“¤(items)ì„ ì‹¤ì œë¡œ í™”ë©´ì— ì˜ˆìœ ì¹´ë“œë¡œ ë§Œë“­ë‹ˆë‹¤.
    // -> render í•¨ìˆ˜ì—ê²Œ "ì´ê±° ì´ì–´ ë¶™ì¼ì§€(append) ìƒˆë¡œ ê·¸ë¦´ì§€" ì•Œë ¤ì¤ë‹ˆë‹¤.
    render(items, { append });

    // 9. [ë‹¤ìŒ ì¤€ë¹„] "ì„œë²„ë‹˜, ë‹¤ìŒ í˜ì´ì§€ ë˜ ìˆë‚˜ìš”?"
    // -> ìˆìœ¼ë©´ ë²ˆí˜¸í‘œ(token)ë¥¼ ì±™ê¸°ê³ , ì—†ìœ¼ë©´ null(ë).
    nextPageToken = r.nextPageToken || null;
    
    // -> ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆìœ¼ë©´ 'ë” ë³´ê¸°' ë²„íŠ¼ì„ ë³´ì—¬ì£¼ê³ , ì—†ìœ¼ë©´ ìˆ¨ê¹ë‹ˆë‹¤.
    setLoadMoreVisible(!!nextPageToken);

  } catch (err) {
    // 10. [ì—ëŸ¬ ì²˜ë¦¬] ì„œë²„ê°€ ê³ ì¥ ë‚¬ê±°ë‚˜ ì¸í„°ë„·ì´ ëŠê²¼ì„ ë•Œ
    console.warn('search failed, fallback to local', err);

    // -> [í”Œëœ B] ë§Œì•½ 'ìƒˆ ê²€ìƒ‰' ì¤‘ì´ì—ˆë‹¤ë©´ í™”ë©´ì´ í…… ë¹„ë‹ˆê¹Œ,
    // -> ì•± ì•ˆì— ë‚´ì¥ëœ ê¸°ë³¸ ë…¸ë˜ ëª©ë¡(API.list())ì´ë¼ë„ ë³´ì—¬ì¤ë‹ˆë‹¤.
    if (!append) {
      const items = API.list();
      lastSearchList = items.slice();
      render(items, { append: false });
      
      // ê¸°ë³¸ ëª©ë¡ì´ë‹ˆ ë‹¤ìŒ í˜ì´ì§€ëŠ” ì—†ìŠµë‹ˆë‹¤.
      nextPageToken = null;
      setLoadMoreVisible(false);
    }
  } finally {
    // 11. [ë’·ì •ë¦¬] ì„±ê³µí•˜ë“  ì‹¤íŒ¨í•˜ë“  ë¬´ì¡°ê±´ ì‹¤í–‰ë˜ëŠ” ê³³
    // -> "ì‘ì—… ëë‚¬ìŠµë‹ˆë‹¤!" ê¹ƒë°œì„ ë‚´ë ¤ì„œ ë‹¤ì‹œ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
    isLoading = false;
  }
}

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ë¬´í•œ ìŠ¤í¬ë¡¤ ì²´í¬ í•¨ìˆ˜
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ìŠ¤í¬ë¡¤ì´ ë°”ë‹¥ì— ë‹¿ì•˜ëŠ”ì§€ ê°ì‹œí•˜ê³ , ìƒˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
  async function checkInfiniteScroll() {

    // ë¶ˆëŸ¬ì˜¬ í˜ì´ì§€ê°€ ì—†ê±°ë‚˜ ë¡œë”© ì¤‘ì´ë¼ë©´ ì—¬ê¸°ì„œ ë©ˆì¶¤. (ì¤‘ë³µ ë¡œë”© ë°©ì§€)
    if (!nextPageToken || isLoading) return;

    // ë…¸ë˜ ëª©ë¡ì´ ë“¤ì–´ìˆëŠ” ìƒì(ë¦¬ìŠ¤íŠ¸)ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
    const listEl = document.getElementById('resultList');

    // [ 1 ] ë…¸ë˜ ëª©ë¡ ìƒì(ì˜ˆ : ê²€ìƒ‰ì°½) ì•ˆì—ì„œë§Œ ìŠ¤í¬ë¡¤ì´ ìƒê²¼ì„ ë•Œ
    let needMore = false; // "ë” ë¡œë”©í• ê¹Œìš”?"ë¥¼ íŒë‹¨ (ì²˜ìŒì—” 'ì•„ë‹ˆìš”')

    // ìƒìê°€ ì¡´ì¬í•˜ê³ , ë‚´ìš©ë¬¼ì´ ìƒìë³´ë‹¤ ê¸¸ì–´ì„œ ìŠ¤í¬ë¡¤ì´ ìƒê¸´ ìƒíƒœë¼ë©´?
    if (listEl && listEl.scrollHeight > listEl.clientHeight + 10) {
      // í˜„ì¬ ëˆˆì— ë³´ì´ëŠ” ë°”ë‹¥ ìœ„ì¹˜ ê³„ì‚°: (ìŠ¤í¬ë¡¤ ë‚´ë¦° ë§Œí¼ + í™”ë©´ ë†’ì´)
      const bottom = listEl.scrollTop + listEl.clientHeight;
      // ë¡œë”© ë§ˆì§€ë…¸ì„  ì„¤ì • : ë°”ë‹¥ì—ì„œ 300px ì •ë„ ë‚¨ì•˜ì„ ë•Œ ë¯¸ë¦¬ ë¡œë”©
      const limit  = listEl.scrollHeight - 300; 
      //  íŒë‹¨: í˜„ì¬ ë³´ëŠ” ìœ„ì¹˜ê°€ ë§ˆì§€ë…¸ì„ ì„ ë„˜ì—ˆìœ¼ë©´ ë” í•„ìš”í•˜ë‹¤ëŠ” ì‹ í˜¸ë¥¼ ë³´ëƒ„
      if (bottom >= limit) needMore = true;
    }


    // [ 2 ] ì›¹í˜ì´ì§€ ì „ì²´(ìœˆë„ìš°) ìŠ¤í¬ë¡¤ì¼ ë•Œ
    // (ëª©ë¡ ìƒìê°€ ì•„ë‹ˆë¼ í™”ë©´ ì „ì²´ë¥¼ ìŠ¤í¬ë¡¤í•˜ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ë³´í—˜ ì½”ë“œ)
    const root = document.documentElement; // ì›¹í˜ì´ì§€ ì „ì²´ í†µ

    //  í˜„ì¬ ìœˆë„ìš°ì˜ ë°”ë‹¥ ìœ„ì¹˜ ê³„ì‚°
    const winBottom = root.scrollTop + root.clientHeight;
    // ì „ì²´ í˜ì´ì§€ì˜ ë¡œë”© ë§ˆì§€ë…¸ì„  (ë°”ë‹¥ì—ì„œ 300px ìœ„)
    const winLimit  = root.scrollHeight - 300;
    // íŒë‹¨: ì „ì²´ ìŠ¤í¬ë¡¤ì´ ë°”ë‹¥ì— ê°€ê¹Œì›Œì¡Œìœ¼ë©´ "ë” í•„ìš”í•´!"
    if (winBottom >= winLimit) needMore = true;


    // ìµœì¢… ê²°ê³¼
    // ìƒí™© 1ì´ë“  2ë“ , "ë” í•„ìš”í•˜ë‹¤(needMore)"ê³  íŒë‹¨ë˜ë©´
    if (needMore) {
      // ì„œë²„ì—ì„œ ë‹¤ìŒ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ í™”ë©´ì— 'ì´ì–´ ë¶™ì´ê¸°(append: true)'.
      await fetchAndRender({ append: true });
    }
  }
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('searchForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const q = document.getElementById('searchInput').value.trim();

    try {
      const r = await API.search({ q });   // â† ë°±ì—”ë“œ /api/search í˜¸ì¶œ
      render(r.items);
    } catch (err) {
      console.warn('search failed, fallback to local', err);
      render(API.list());                  // ì„œë²„ ì•ˆ ì¼œì ¸ ìˆìœ¼ë©´ ì„ì‹œ í´ë°±
    }
  });

// â˜…â˜…â˜… 'ë” ë³´ê¸° ë²„íŠ¼(loadMoreBtn)'ì„ í´ë¦­(click)í–ˆì„ ë•Œ ì‹¤í–‰í•  í–‰ë™ ì •ì˜
document.getElementById('loadMoreBtn').addEventListener('click', async () => {
  
  // -> ë‹¤ìŒ í˜ì´ì§€ ë²ˆí˜¸í‘œ(nextPageToken)ê°€ ì—†ë‹¤ë©´, ë” ë¶ˆëŸ¬ì˜¬ ê²Œ ì—†ìœ¼ë‹ˆ ì•„ë¬´ê²ƒë„ ì•ˆ í•˜ê³  ë©ˆì¶¥ë‹ˆë‹¤.
  if (!nextPageToken) return;

  // [ë°ì´í„° ê°€ì ¸ì˜¤ê¸°] ë‹¤ìŒ í˜ì´ì§€ ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
  // -> append: true (ì¤‘ìš”!): "ê¸°ì¡´ ëª©ë¡ì„ ì§€ìš°ì§€ ë§ê³ , ê·¸ ë°‘ì— ì´ì–´ì„œ ë¶™ì—¬ë¼"ëŠ” ëœ»ì…ë‹ˆë‹¤.
  await fetchAndRender({ append: true });
});

  // â˜… ë¬´í•œ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë“±ë¡
  window.addEventListener('scroll', checkInfiniteScroll);
  document.getElementById('resultList').addEventListener('scroll', checkInfiniteScroll);

  // ì´ˆê¸° ì§„ì… ì‹œ: mood/genre/nationë§Œìœ¼ë¡œ ì²« í˜ì´ì§€ ìë™ ë¡œë“œ
  (async () => {
    try {
      const r = await API.search({});
      render(r.items);
    } catch {
      render(API.list());
    }
  })();
  </script>
</body>
</html>